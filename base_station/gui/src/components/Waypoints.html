<div class="wrapper" id="waypoint-comp">
    <div class="box">
        <p>
            <b>Current Goal GPS</b> - {{current.name}}:
            <span>
                {{current.n}} N &nbsp;&nbsp;&nbsp; {{current.w}} W
            </span>
        </p>
        
    </div>
    <div class="box" id="gps-input">
        <div>
            <p>
                <b>Set Goal GPS</b>
            </p>
        </div>
        <div class="input-area">
            <input type="text" ref:nDeg next="nMin">º
            <input type="text" ref:nMin next="nSec">'
            <input type="text" ref:nSec next="wDeg">" N
        </div>


        <div>
            <input type="text" ref:waypointName next="nDeg">
        </div>

        <div class="input-area">
            <input type="text" ref:wDeg next="wMin">º
            <input type="text" ref:wMin next="wSec">'
            <input type="text" ref:wSec next="waypointName">" W
        </div>
        
    </div>
    <div class="box" id="waypoint-list">
        <ol>
        {{#each waypointList as waypoint}}
            <!-- Easier to store variables -->
            <div style="display: none;">
                {{lat_min = waypoint["latitude_min"]}}
                {{lon_min = waypoint["longitude_min"]}}
            </div>
            <li>{{waypoint["name"]}}: {{ waypoint["latitude_deg"] }}º 
                                      {{ Math.floor(lat_min) }}' 
                                      {{ ((lat_min-Math.floor(lat_min))*60).toFixed(4) }}" N
                                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                      {{ waypoint["longitude_deg"] }}º 
                                      {{ Math.floor(lon_min) }}' 
                                      {{ ((lon_min-Math.floor(lon_min))*60).toFixed(4) }}" W</li>
        {{/each}}
        </ol>
    </div>
</div>

<script>

const isChildOfID=function(element, id){
    while(element.id!="waypoint-comp"){
        if(element.id===id)
            return true;
        else
            element=element.parentElement;
    }
    return false;
}

export default {
    data() {
        return {
            current: {
              name: "Waypoint 1",
              n: "73º 43’ 6.7823\"",
              w: "73º 43’ 6.7823\""
            },

            waypointList: []
        }
    },

    oncreate() {
        const myInput = document.getElementById("waypoint-comp");
        if(myInput.addEventListener) {
            myInput.addEventListener('keydown', (e) => {

                const TABKEY = 9;
                const ENTER = 13;
                const ESC = 27;

                if(e.keyCode == TABKEY) {

                    const nextRef=document.activeElement.getAttribute("next");
                    if(!nextRef)
                        return;

                    this.refs[nextRef].focus();

                    if(e.preventDefault) {
                        e.preventDefault();
                    }
                    return false;
                }else if(e.keyCode == ENTER){
                    if(isChildOfID(document.activeElement, "gps-input")){
                        const name=this.refs.waypointName.value;
                        const nDeg=this.refs.nDeg.value|0;
                        const nMin=this.refs.nMin.value|0;
                        const nSec=+this.refs.nSec.value;
                        const wDeg=this.refs.wDeg.value|0;
                        const wMin=this.refs.wMin.value|0;
                        const wSec=+this.refs.wSec.value;

                        this.refs.waypointName.value="";
                        this.refs.nDeg.value="";
                        this.refs.nMin.value="";
                        this.refs.nSec.value="";
                        this.refs.wDeg.value="";
                        this.refs.wMin.value="";
                        this.refs.wSec.value="";
                        this.refs.waypointName.focus();

                        const lcm_message = {type: "Odometry",
                                             "name": name,
                                             "latitude_deg": nDeg,
                                             "latitude_min": nMin+nSec/60.0,
                                             "longitude_deg": wDeg,
                                             "longitude_min": wMin+wSec/60.0,
                                             "bearing_deg": 0};

                        this.set({
                            current:{
                                name: name,
                                n: nDeg+"º "+nMin+"' "+nSec+"\"",
                                w: wDeg+"º "+wMin+"' "+wSec+"\""
                            }
                        });

                        this.set({
                            waypointList : this.get("waypointList").concat(lcm_message)
                        });
                    }
                }else if(e.keyCode == ESC){
                    document.activeElement.blur();
                }

            } ,false);
        }
    }
}
</script>

<style>
  .wrapper {
    display: grid;

    grid-gap: 10px;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr 1fr 6fr;
    grid-template-areas: unset;
  }

  .box {
    padding: 0px;
    padding-left: 5px;
    padding-right: 5px;
}

#gps-input{
    padding-top: 5px;
    display: grid;

    grid-gap: 10px;
    grid-template-columns: 3fr 5fr;
    grid-template-rows: 20px 20px;
}

#waypoint-list{
    overflow-y: scroll;
    overflow-x:hidden;
}

li{
    margin: 20px 0;
    font-size: 1.2rem;
}

.input-area{
    float: right;
}

p{
	font-size: 1.25rem;
	margin-top: 5px;
	text-align: left;
}

span{
	float: right;
}

</style>
